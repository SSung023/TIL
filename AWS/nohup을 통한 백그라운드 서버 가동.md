## AWS - nohup을 이용한 무중단 서비스

> 대학교에서 교수님과 함께 진행했던 프로젝트에서 AWS를 사용하게 되었는데,  
> *java -jar* 명령어를 통해서 서버를 가동시키니 터미널을 종료하면 서버가 중단되어 버리는 문제가 발생했다.  
> 프로젝트가 끝나기 전까지 상시 가동되어야 하는 상황인지라 무중단 서비스를 찾다가 nohup을 이용한 방법을 찾아서 기록하고자 한다.

<br>

#### 1.빌드 및 파일 올리기
테스트를 포함한 빌드 명령어
```
❯ ./gradlew build
```
테스트를 제외한 빌드 명령어
```
❯ ./gradlew -x text
```

위 명령어를 통해 프로젝트를 빌드를 완료했으면 AWS 인스턴스에 빌드 파일을 올려야 한다.  
scp를 통해 파일만 올리는 방법도 있고, Git을 통해 올리는 방법도 있다.

나는 git에 올리고 AWS 인스턴스에서 받아오는 방법을 사용했다.  
.gitignore에 기본적으로 build 경로들이 모두 올라가지 않도록 설정되어 있는 경우가 있는데, .gitignore 파일을 수정해서 빌드 파일들도 같이 올라가도록 설정했다.  

<br>

***

#### 2. nohup 이용하여 서버 띄우기
우리가 일반적으로 java 빌드 파일을 실행할 때에 ***java -jar*** 를 사용하는데,  
nohup을 사용할 때에는 앞에 nohup을 붙이고 뒤에 &를 붙이면 된다.
```
❯ nohup java -jar ChatPrompt-0.0.1-SNAPSHOT.jar&
```
위 명령어를 사용하여 서버를 띄우게 되면 터미널을 종료해도 백그라운드에서 계속 실행된다.  

여기서 유의할 점은 nohup을 통해 서버를 띄우면 java -jar로 띄웠을 때와 달리 log가 터미널에 보이지 않는다는 점이다.  
log는 같은 디렉토리 안의 ***nohup.out*** 에 저장된다.


<br>

***

#### 3. nohup으로 실행한 프로그램 중단하기
java -jar로 실행한 프로그램을 중단하고 싶을 때에는 ⌃c 를 누르면 된다.  
nohup의 경우에는 PID를 kill 하는 방식을 사용해야 한다.

<br>

우리가 kill 하려는 프로그램의 PID를 알아보기 위해서는 밑과 같은 명령어를 사용하면 된다.  
밑의 명령어는 Java 에 해당하는 PID를 반환받는 명령어이다.
```
❯ ps ef | -grep java
```

혹은 실행했던 파일의 이름을 알고 있을 때에는 파일의 이름을 적어도 PID를 알 수 있다.
```
❯ ps ef | -grep ChatPrompt-0.0.1-SNAPSHOT.jar
```

명령어를 통해 실행되고 있는 프로그램의 PID *(ex - 1231)* 를 알아냈다면, 밑의 명령어를 통해 중단시킬 수 있다.
```
❯ kill -9 1231
```